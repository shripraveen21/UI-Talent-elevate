<main class="container mx-auto max-w-2xl px-4 py-10">
  <div class="bg-white p-8 rounded-lg border border-gray-200 shadow-soft">
    <ng-container *ngIf="isLoading">
      <div class="flex flex-col items-center justify-center py-8">
        <svg class="animate-spin h-8 w-8 text-primary mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
        <span class="text-primary font-medium text-lg">Loading...</span>
      </div>
    </ng-container>
    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-primary" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
      Hands-On Project Setup
    </h2>
    <form (ngSubmit)="onSubmit()" #handsonForm="ngForm" class="space-y-6">
      <!-- Read-only Techstack and Topics display -->
      <div class="card p-4 mb-6 bg-gray-50 border border-gray-200 rounded-lg">
        <div class="mb-2">
          <span class="font-semibold text-gray-700">Tech Stack:</span>
          <span class="ml-2 text-gray-900">{{ readOnlyTechStack }}</span>
        </div>
        <div>
          <span class="font-semibold text-gray-700">Topics:</span>
          <span class="ml-2 text-gray-900">
            <ng-container *ngIf="readOnlyTopics.length; else noTopics">
              <span *ngFor="let topic of readOnlyTopics; let last = last">
                {{ topic }}<span *ngIf="!last">, </span>
              </span>
            </ng-container>
            <ng-template #noTopics>
              <span class="text-gray-400">None selected</span>
            </ng-template>
          </span>
        </div>
      </div>
      <div>
        <app-shared-dropdown
          [options]="difficultyLevels"
          [selectedOption]="selectedDifficultyLevel"
          [label]="'Difficulty'"
          [placeholder]="'Select Difficulty'"
          [disabled]="false"
          (selectionChange)="onDifficultyChange($event)">
        </app-shared-dropdown>
      </div>
      <div>
        <label for="duration" class="label">Duration (minutes)</label>
        <input id="duration" [(ngModel)]="duration" name="duration" type="number" min="1" required class="input-field" />
      </div>
      <div class="text-center">
        <button type="submit" class="btn-primary w-full">Start Hands-On</button>
      </div>
    </form>

    <div class="mt-8">
      <ng-container *ngIf="srsReview">
        <div class="card p-4 mb-4">
          <h3 class="text-xl font-semibold mb-2">SRS Review (Attempt {{srsReview.regen_count}}/{{srsReview.max_regen}})
          </h3>
          <pre class="bg-gray-50 rounded-md p-3 text-sm mb-4">{{srsReview.content.srs_md}}</pre>
          <div class="flex gap-4 justify-end">
            <button class="btn-success" (click)="approve()">Approve</button>
            <button class="btn-secondary" (click)="suggest()">Suggest Changes</button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="finalData">
        <div class="card p-4 mb-4">
          <h3 class="text-xl font-semibold mb-2">SRS Finalized!</h3>
          <pre class="bg-gray-50 rounded-md p-3 text-sm mb-4">{{finalData | json}}</pre>
          <!-- If using Angular v15+, ensure JsonPipe is imported in the module or @Component.imports -->
          <div class="text-right">
            <button class="btn-primary" (click)="saveHandson()">Save HandsOn</button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="handsonStored">
        <div class="card p-4 mb-4">
          <h3 class="text-xl font-semibold mb-2 text-success">HandsOn Saved!</h3>
        </div>
      </ng-container>

      <ng-container *ngIf="error">
        <div class="card p-4 mb-4">
          <span class="error-text">{{error}}</span>
        </div>
      </ng-container>
    </div>
  </div>
</main>
