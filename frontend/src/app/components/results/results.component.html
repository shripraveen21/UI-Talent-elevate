<div *ngIf="loading">Loading results...</div>
<div *ngIf="error">{{ error }}</div>

<div *ngIf="!loading && !error && result && !feedback">
  <h2>Thanks for submitting.</h2>
  <p>Your results have been stored and you will get feedback soon.</p>
</div>

<div *ngIf="feedback">
  <h3>Feedback Analysis</h3>
  <div *ngIf="feedback.analysis">
    <div *ngIf="feedback.analysis.strengths?.length">
      <h4>Strengths</h4>
      <ul>
        <li *ngFor="let s of feedback.analysis.strengths">
          <strong>{{ s.topic }}</strong>:
          <span *ngIf="s.concepts_mastered?.length">Mastered: {{ s.concepts_mastered.join(', ') }}</span>
          <span *ngIf="s.remarks">Remarks: {{ s.remarks }}</span>
        </li>
      </ul>
    </div>
    <div *ngIf="feedback.analysis.weaknesses?.length">
      <h4>Weaknesses</h4>
      <ul>
        <li *ngFor="let w of feedback.analysis.weaknesses">
          <strong>{{ w.topic }}</strong>:
          <span *ngIf="w.concepts_weak?.length">Weak: {{ w.concepts_weak.join(', ') }}</span>
          <span *ngIf="w.areas_of_improvement">Improvement: {{ w.areas_of_improvement }}</span>
        </li>
      </ul>
    </div>
  </div>
  <div *ngIf="feedback.quiz_result">
    <h4>Quiz Summary</h4>
    <div>Total Questions: {{ feedback.quiz_result.total_questions }}</div>
    <div>Correct Answers: {{ feedback.quiz_result.correct_answers }}</div>
    <div>Score Percentage: {{ feedback.quiz_result.score_percentage }}%</div>
  </div>

  <!-- Recommended Resources Section -->
  <div *ngIf="resources && resources.length > 0" class="resources-section">
    <h4>Recommended Resources</h4>
    <ul>
      <li *ngFor="let res of resources">
        <strong>{{ res.topic }}:</strong>
        <a [href]="res.resource_url" target="_blank">{{ res.resource_url }}</a>
      </li>
    </ul>
  </div>
  <div *ngIf="feedback.critique">
    <h4>Critique</h4>
    <div>Overall Score: {{ feedback.critique.overall_score }}/10</div>
    <div *ngIf="feedback.critique.strengths?.length">
      <strong>Strengths:</strong> {{ feedback.critique.strengths.join(', ') }}
    </div>
    <div *ngIf="feedback.critique.weaknesses?.length">
      <strong>Weaknesses:</strong> {{ feedback.critique.weaknesses.join(', ') }}
    </div>
    <div *ngIf="feedback.critique.recommendations?.length">
      <strong>Recommendations:</strong> {{ feedback.critique.recommendations.join(', ') }}
    </div>
  </div>
  <div *ngIf="feedback.error">{{ feedback.error }}</div>
</div>
