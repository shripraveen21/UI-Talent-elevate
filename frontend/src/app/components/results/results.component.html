<div class="max-w-3xl mx-auto my-8 p-6 bg-white rounded-lg shadow-lg">

  <div *ngIf="loading" class="flex items-center justify-center py-8">
    <span class="text-blue-600 font-semibold text-lg animate-pulse">Loading results...</span>
  </div>

  <div *ngIf="error" class="flex items-center justify-center py-8">
    <span class="text-red-500 font-semibold text-lg">{{ error }}</span>
  </div>

  <div *ngIf="pending" class="text-center py-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Test submitted successfully.</h2>
    <p class="text-gray-600">Your results are being processed. Please wait for feedback.</p>
  </div>

  <div *ngIf="!loading && !error && result && !feedback" class="text-center py-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Thanks for submitting.</h2>
    <p class="text-gray-600">Your results have been stored and feedback is getting generated.</p>
  </div>

  <div *ngIf="feedback">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">Feedback Analysis</h3>

    <div *ngIf="feedback.analysis" class="mb-6">
      <div *ngIf="feedback.analysis.strengths?.length" class="mb-4">
        <h4 class="text-lg font-semibold text-green-700 mb-2">Strengths</h4>
        <ul class="list-disc list-inside ml-4 text-gray-700">
          <li *ngFor="let s of feedback.analysis.strengths">
            <strong>{{ s.topic }}</strong>:
            <span *ngIf="s.concepts_mastered?.length">Mastered: {{ s.concepts_mastered.join(', ') }}</span>
            <span *ngIf="s.remarks">Remarks: {{ s.remarks }}</span>
          </li>
        </ul>
      </div>
      <div *ngIf="feedback.analysis.weaknesses?.length" class="mb-4">
        <h4 class="text-lg font-semibold text-yellow-700 mb-2">Weaknesses</h4>
        <ul class="list-disc list-inside ml-4 text-gray-700">
          <li *ngFor="let w of feedback.analysis.weaknesses">
            <strong>{{ w.topic }}</strong>:
            <span *ngIf="w.concepts_weak?.length">Weak: {{ w.concepts_weak.join(', ') }}</span>
            <span *ngIf="w.areas_of_improvement">Improvement: {{ w.areas_of_improvement }}</span>
          </li>
        </ul>
      </div>
    </div>

    <div *ngIf="feedback.quiz_result" class="mb-6">
      <h4 class="text-lg font-semibold text-blue-700 mb-2">Quiz Summary</h4>
      <div class="text-gray-700">Total Questions: {{ feedback.quiz_result.total_questions }}</div>
      <div class="text-gray-700">Correct Answers: {{ feedback.quiz_result.correct_answers }}</div>
      <div class="text-gray-700">Score Percentage: {{ feedback.quiz_result.score_percentage }}%</div>
    </div>

    <div *ngIf="resources && resources.length > 0" class="mb-6">
      <h4 class="text-lg font-semibold text-indigo-700 mb-2">Recommended Resources</h4>
      <ul class="list-disc list-inside ml-4 text-gray-700">
        <li *ngFor="let res of resources">
          <strong>{{ res.topic }}:</strong>
          <a [href]="res.resource_url" target="_blank" class="text-blue-600 underline">{{ res.resource_url }}</a>
        </li>
      </ul>
    </div>

    <div *ngIf="feedback.critique" class="mb-6">
      <h4 class="text-lg font-semibold text-purple-700 mb-2">Critique</h4>
      <div class="text-gray-700 mb-1">Overall Score: {{ feedback.critique.overall_score }}/10</div>
      <div *ngIf="feedback.critique.strengths?.length" class="mb-1">
        <strong class="text-green-700">Strengths:</strong> {{ feedback.critique.strengths.join(', ') }}
      </div>
      <div *ngIf="feedback.critique.weaknesses?.length" class="mb-1">
        <strong class="text-yellow-700">Weaknesses:</strong> {{ feedback.critique.weaknesses.join(', ') }}
      </div>
      <div *ngIf="feedback.critique.recommendations?.length" class="mb-1">
        <strong class="text-blue-700">Recommendations:</strong> {{ feedback.critique.recommendations.join(', ') }}
      </div>
    </div>

    <div *ngIf="feedback.error" class="text-red-500 font-semibold text-lg">{{ feedback.error }}</div>
  </div>
</div>